/* js-interview 
*/
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),GameOverEvent=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.WIN="GameOverEvent.WIN",e.LOSE="GameOverEvent.LOSE",e}(EventObject),PlayerLivesUpdatedEvent=function(e){function t(){return e.call(this,t.UPDATED)||this}return __extends(t,e),t.UPDATED="PlayerLivesUpdatedEvent.UPDATED",t}(EventObject),PlayerScoreUpdatedEvent=function(e){function t(){return e.call(this,t.UPDATED)||this}return __extends(t,e),t.UPDATED="PlayerScoreUpdatedEvent.UPDATED",t}(EventObject),GameController=function(){function e(e){this.model=e,this.create(),this.addEventListeners()}return e.prototype.create=function(){this.createEventBus()},e.prototype.createEventBus=function(){this.eventBus=EventBus.getInstance()},e.prototype.addEventListeners=function(){this.listen(EnemyShipEvent.DEAD,this.handleEnemyShipDead,this),this.listen(PlayerShipEvent.DEAD,this.handlePlayerShipDead,this)},e.prototype.handleEnemyShipDead=function(e){this.model.enemyShipDead(),this.model.updateScore(1),this.dispatchEvent(new PlayerScoreUpdatedEvent),0==this.model.getEnemiesLeft()&&this.dispatchEvent(new GameOverEvent(GameOverEvent.WIN))},e.prototype.handlePlayerShipDead=function(e){this.model.playerShipDead(),this.dispatchEvent(new PlayerLivesUpdatedEvent),0==this.model.getNumLives()&&this.dispatchEvent(new GameOverEvent(GameOverEvent.LOSE))},e.prototype.listen=function(e,t,i){this.eventBus.addEventListener(e,t,i)},e.prototype.remove=function(e,t){this.eventBus.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){this.eventBus.dispatchEvent(e)},e}(),Game=function(){function e(){this.createRenderer(),this.createLoader()}return e.prototype.createRenderer=function(){this.renderer=AbstractRenderer.getInstance().initialise(new PIXI.Point(300,350))},e.prototype.createLoader=function(){this.loader=new Loader("xml/Config.xml"),this.loader.addEventListener(EventType.COMPLETE,this.handleLoadComplete,this),this.loader.load()},e.prototype.createModel=function(){this.model=new GameModel(this.loader.getConfig())},e.prototype.createController=function(){this.controller=new GameController(this.model)},e.prototype.createView=function(){this.view=new GameView(this.model),this.renderer.addChild(this.view)},e.prototype.handleLoadComplete=function(){this.createModel(),this.createController(),this.createView()},e}(),GameModel=function(){function e(e){this.config=e,this.reset()}return e.prototype.reset=function(){this.numEnemies=this.config.getNumEnemies(),this.numLives=this.config.getNumLives(),this.numShields=this.config.getNumShields(),this.enemiesLeft=this.config.getNumEnemies(),this.score=0},e.prototype.enemyShipDead=function(){this.enemiesLeft--},e.prototype.playerShipDead=function(){this.numLives--},e.prototype.updateScore=function(e){this.score+=e},e.prototype.getEnemiesLeft=function(){return this.enemiesLeft},e.prototype.getScore=function(){return this.score},e.prototype.getNumLives=function(){return this.numLives},e.prototype.getNumEnemies=function(){return this.numEnemies},e.prototype.getNumShields=function(){return this.numShields},e}(),AbstractView=function(i){function e(e){var t=i.call(this)||this;return t.model=e,t.create(),t.addEventListeners(),t}return __extends(e,i),e.prototype.create=function(){this.createEventBus(),this.createRenderer()},e.prototype.createRenderer=function(){this.renderer=AbstractRenderer.getInstance()},e.prototype.createEventBus=function(){this.eventBus=EventBus.getInstance()},e.prototype.listenGame=function(e,t,i){this.eventBus.addEventListener(e,t,i)},e.prototype.removeGame=function(e,t){this.eventBus.removeEventListener(e,t)},e.prototype.dispatchGame=function(e){this.eventBus.dispatchEvent(e)},e.prototype.addEventListeners=function(){},e.prototype.removeEventListeners=function(){},e}(PIXI.Container),EnemyBullet=function(n){function e(e,t){var i=n.call(this,e)||this;return i.sprite.position=t,i}return __extends(e,n),e.prototype.create=function(){n.prototype.create.call(this),this.createBullet()},e.prototype.dispose=function(){this.parent&&this.renderer.removeChild(this)},e.prototype.createBullet=function(){this.sprite=AssetManager.getSprite(AssetManager.ENEMY_BULLET),this.addChild(this.sprite)},e.prototype.fire=function(){this.renderer.addChild(this),this.tween=TweenMax.to(this.sprite.position,1,{y:this.renderer.getGameSize().y,ease:Linear.easeNone,onUpdate:ObjectUtil.delegate(this.handleTweenUpdate,this),onComplete:ObjectUtil.delegate(this.handleTweenComplete,this)})},e.prototype.handleTweenUpdate=function(){this.dispatchGame(new EnemyBulletEvent(this))},e.prototype.handleTweenComplete=function(){this.dispose()},e.prototype.getSprite=function(){return this.sprite},e}(AbstractView),EnemyShip=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){e.prototype.create.call(this),this.createShip(),this.createTweens(),this.startMoveTimer(),this.startFireTimer()},t.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),this.moveTimer.removeEventListener(TimerEvent.TIMER,this),this.fireTimer.removeEventListener(TimerEvent.TIMER,this),this.removeGame(PlayerBulletEvent.MOVE,this),this.dispatchGame(new EnemyShipEvent)},t.prototype.addEventListeners=function(){this.listenGame(PlayerBulletEvent.MOVE,this.handlePlayerBullet,this)},t.prototype.createShip=function(){this.ship=AssetManager.getMovieClip(AssetManager.ENEMY_SHIP),this.ship.play(),this.addChild(this.ship)},t.prototype.createTweens=function(){this.tweens=new Dictionary},t.prototype.startMoveTimer=function(){this.moveTimer=new Timer(1e3),this.moveTimer.addEventListener(TimerEvent.TIMER,this.handleMoveTimerUpdate,this),this.moveTimer.start()},t.prototype.startFireTimer=function(){this.fireTimer=new Timer(1500),this.fireTimer.addEventListener(TimerEvent.TIMER,this.handleFireTimeUpdate,this),this.fireTimer.start()},t.prototype.handleMoveTimerUpdate=function(e){this.move(this.randomPoint)},t.prototype.handleFireTimeUpdate=function(e){new EnemyBullet(this.model,this.ship.position.clone()).fire()},t.prototype.handlePlayerBullet=function(e){BoundsUtil.isInBounds(this.ship,e.getBullet().getSprite())&&this.dispose()},t.prototype.move=function(e){this.tweens.setValue("x",TweenMax.to(this.ship.position,1,{x:e.x,ease:Linear.easeIn})),this.tweens.setValue("y",TweenMax.to(this.ship.position,1,{y:e.y,ease:Linear.easeIn}))},Object.defineProperty(t.prototype,"randomPoint",{get:function(){var e=Math.random()*(this.renderer.getGameSize().x-this.ship.width),t=Math.random()*(this.renderer.getGameSize().y-this.ship.height-150);return new PIXI.Point(e,t)},enumerable:!0,configurable:!0}),t}(AbstractView),PlayerBullet=function(n){function e(e,t){var i=n.call(this,e)||this;return i.sprite.position=t,i}return __extends(e,n),e.prototype.create=function(){n.prototype.create.call(this),this.createBullet()},e.prototype.dispose=function(){this.parent&&this.renderer.removeChild(this)},e.prototype.createBullet=function(){this.sprite=AssetManager.getSprite(AssetManager.PLAYER_BULLET),this.addChild(this.sprite)},e.prototype.fire=function(){this.renderer.addChild(this),this.tween=TweenMax.to(this.sprite.position,1,{y:0,ease:Linear.easeNone,onUpdate:ObjectUtil.delegate(this.handleTweenUpdate,this),onComplete:ObjectUtil.delegate(this.handleTweenComplete,this)})},e.prototype.handleTweenUpdate=function(){this.dispatchGame(new PlayerBulletEvent(this))},e.prototype.handleTweenComplete=function(){this.dispose()},e.prototype.getSprite=function(){return this.sprite},e}(AbstractView),PlayerShip=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){e.prototype.create.call(this),this.createShip()},t.prototype.createShip=function(){this.ship=AssetManager.getSprite(AssetManager.PLAYER_SHIP),this.ship.interactive=!0,this.addChild(this.ship),this.ship.position=new PIXI.Point(125,this.renderer.getGameSize().y-this.renderer.getGameSize().y/8)},t.prototype.dispose=function(){this.ship.parent&&this.removeChild(this.ship),this.removeEventListeners(),this.dispatchGame(new PlayerShipEvent)},t.prototype.addEventListeners=function(){var e=this.renderer.getStage();MouseUtil.setInteractive(e,!0),MouseUtil.addMouseMove(e,this.handleMouseMove,this),MouseUtil.addMouseDown(e,this.handleMouseDown,this),this.listenGame(EnemyBulletEvent.MOVE,this.handleEnemyBulletMove,this)},t.prototype.removeEventListeners=function(){var e=this.renderer.getStage();MouseUtil.removeMouseMove(e,this.handleMouseMove),MouseUtil.removeMouseDown(e,this.handleMouseDown),this.removeGame(EnemyBulletEvent.MOVE,this)},t.prototype.handleMouseDown=function(){var e=this.ship.position.x+this.ship.width/2,t=this.ship.position.y,i=new PIXI.Point(e,t);new PlayerBullet(this.model,i).fire()},t.prototype.handleMouseMove=function(e){var t=e.data;this.ship.position=new PIXI.Point(t.global.x,this.ship.position.y)},t.prototype.handleEnemyBulletMove=function(e){BoundsUtil.isInBounds(this.ship,e.getBullet().getSprite())&&this.dispose()},t.prototype.revive=function(){var e=this.renderer.getStage();MouseUtil.setInteractive(e,!0),MouseUtil.addMouseMove(e,this.handleMouseMove,this),MouseUtil.addMouseDown(e,this.handleMouseDown,this),this.startFlashTimer(),this.addChild(this.ship)},t.prototype.startFlashTimer=function(){var e=new Timer(300,5);e.addEventListener(TimerEvent.TIMER,this.handleFlashTimerUpdate,this),e.addEventListener(TimerEvent.COMPLETE,this.handleFlashTimerComplete,this),e.start()},t.prototype.handleFlashTimerUpdate=function(e){this.ship.visible=!this.ship.visible},t.prototype.handleFlashTimerComplete=function(e){this.ship.visible=!0,this.listenGame(EnemyBulletEvent.MOVE,this.handleEnemyBulletMove,this)},t}(AbstractView),Shield=function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return __extends(s,e),s.prototype.create=function(){e.prototype.create.call(this),this.createBlocks()},s.prototype.addEventListeners=function(){this.listenGame(PlayerBulletEvent.MOVE,this.handlePlayerBulletMove,this),this.listenGame(EnemyBulletEvent.MOVE,this.handleEnemyBulletMove,this)},s.prototype.createBlocks=function(){this.blocks=[];for(var e=0;e<s.STRUCTURE.length;e++)for(var t=s.STRUCTURE[e],i=void 0,n=t.x;n<t.y;n++)i=this.createBlock(n,e),this.addChild(i),this.blocks.push(i)},s.prototype.createBlock=function(e,t){var i=AssetManager.getSprite(AssetManager.SHIELD);return i.position=new PIXI.Point(e*i.width,t*i.height),i},s.prototype.handlePlayerBulletMove=function(e){var t=e.getBullet(),i=this.checkBlockBounds(t.getSprite());i&&(i.visible=!1,t.dispose())},s.prototype.handleEnemyBulletMove=function(e){var t=e.getBullet(),i=this.checkBlockBounds(t.getSprite());i&&(i.visible=!1,t.dispose())},s.prototype.checkBlockBounds=function(e){for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];if(i.visible&&BoundsUtil.isInBounds(i,e))return i}return null},s.STRUCTURE=[new PIXI.Point(0,10),new PIXI.Point(1,9),new PIXI.Point(2,8)],s}(AbstractView),EnemyBulletEvent=function(i){function n(e){var t=i.call(this,n.MOVE)||this;return t.bullet=e,t}return __extends(n,i),n.prototype.getBullet=function(){return this.bullet},n.MOVE="EnemyBulletEvent.MOVE",n}(EventObject),EnemyShipEvent=function(e){function t(){return e.call(this,t.DEAD)||this}return __extends(t,e),t.DEAD="EnemyShipEvent.DEAD",t}(EventObject),PlayerBulletEvent=function(i){function n(e){var t=i.call(this,n.MOVE)||this;return t.bullet=e,t}return __extends(n,i),n.prototype.getBullet=function(){return this.bullet},n.MOVE="PlayerBulletEvent.MOVE",n}(EventObject),PlayerShipEvent=function(e){function t(){return e.call(this,t.DEAD)||this}return __extends(t,e),t.DEAD="PlayerShipEvent.DEAD",t}(EventObject),GameView=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.create=function(){t.prototype.create.call(this),this.createBackground(),this.createPlayerShip(),this.createEnemyShips(),this.createShields(),this.createFields()},e.prototype.addEventListeners=function(){this.listenGame(PlayerLivesUpdatedEvent.UPDATED,this.handlePlayerLivesUpdate,this),this.listenGame(PlayerScoreUpdatedEvent.UPDATED,this.handlePlayerScoreUpdate,this)},e.prototype.createBackground=function(){this.background=GraphicsUtil.createRectangle(this.renderer.getGameSize()),this.addChild(this.background)},e.prototype.createPlayerShip=function(){this.playerShip=new PlayerShip(this.model),this.addChild(this.playerShip)},e.prototype.createEnemyShips=function(){var e;this.enemyShips=[];for(var t=0;t<this.model.getNumEnemies();t++)e=new EnemyShip(this.model),this.enemyShips.push(e),this.renderer.addChild(e)},e.prototype.createShields=function(){var e,t=new PIXI.Point(17,this.renderer.getGameSize().y-this.renderer.getGameSize().y/5);this.shields=[];for(var i=0;i<this.model.getNumShields();i++)(e=new Shield(this.model)).position=t,t=new PIXI.Point(t.x+this.renderer.getGameSize().x/this.model.getNumShields(),t.y),this.addChild(e),this.shields.push(e)},e.prototype.createFields=function(){this.createScoreLabel(),this.createScore(),this.createLivesLabel(),this.createLives(),this.createGameName()},e.prototype.createScoreLabel=function(){this.scoreLabel=new PIXI.extras.BitmapText("score",{font:Font.HELVETICA,align:"right"}),this.scoreLabel.position=new PIXI.Point(75,this.renderer.getGameSize().y-20),this.addChild(this.scoreLabel)},e.prototype.createScore=function(){this.score=new PIXI.extras.BitmapText(this.model.getScore().toString(),{font:Font.HELVETICA,align:"left"}),this.score.position=new PIXI.Point(115,this.renderer.getGameSize().y-20),this.addChild(this.score)},e.prototype.createLivesLabel=function(){this.livesLabel=new PIXI.extras.BitmapText("lives",{font:Font.HELVETICA,align:"right"}),this.livesLabel.position=new PIXI.Point(5,this.renderer.getGameSize().y-20),this.addChild(this.livesLabel)},e.prototype.createLives=function(){this.lives=new PIXI.extras.BitmapText(this.model.getNumLives().toString(),{font:Font.HELVETICA,align:"left"}),this.lives.position=new PIXI.Point(40,this.renderer.getGameSize().y-20),this.addChild(this.lives)},e.prototype.createGameName=function(){this.gameName=new PIXI.extras.BitmapText("spaceinvaders",{font:Font.HELVETICA,align:"right"}),this.gameName.position=new PIXI.Point(210,this.renderer.getGameSize().y-20),this.addChild(this.gameName)},e.prototype.handlePlayerScoreUpdate=function(e){this.score.text=this.model.getScore().toString()},e.prototype.handlePlayerLivesUpdate=function(e){this.lives.text=this.model.getNumLives().toString(),0<this.model.getNumLives()&&this.playerShip.revive()},e}(AbstractView),Font=function(){function e(){}return e.HELVETICA="12px Helvetica",e}(),AssetManager=function(){function r(){}return r.addPath=function(e){r.map[e.id]=e},r.getPath=function(e){return r.map[e]},r.getSprite=function(e){var t=this.getPath(e);return PIXI.Sprite.fromImage(t.url)},r.getMovieClip=function(e){for(var t=this.getPath(e),i=[],n=0;n<t.frames;n++){var s=PIXI.Texture.fromFrame(t.id+r.formatTexture(n));i.push(s)}return new PIXI.extras.MovieClip(i)},r.formatTexture=function(e){for(var t=e.toString();t.length<4;)t="0"+t;return t},r.PLAYER_SHIP="PlayerShip",r.PLAYER_BULLET="PlayerBullet",r.ENEMY_SHIP="EnemyShip",r.ENEMY_BULLET="EnemyBullet",r.SHIELD="Shield",r.map=new Dictionary,r}(),BoundsUtil=function(){function e(){}return e.isInBounds=function(e,t){var i=GraphicsUtil.globalPosition(e),n=GraphicsUtil.globalPosition(t);return new PIXI.Rectangle(i.x,i.y).contains(n.x,n.y)},e.globalPosition=function(e){return new PIXI.Point(e.worldTransform.tx,e.worldTransform.ty)},e}(),ConfigData=function(){function e(e){this.document=e,this.numShields=parseInt($(e).find("NumShields").text()),this.numEnemies=parseInt($(e).find("NumEnemies").text()),this.numLives=parseInt($(e).find("NumLives").text()),this.enemySpeed=parseInt($(e).find("EnemySpeed").text()),this.processFiles()}return e.prototype.processFiles=function(){this.files=new Dictionary,$(this.document).find("Files").children().each(ObjectUtil.delegate(this.processFile,this))},e.prototype.processFile=function(e,t){var i=t.nodeName,n=t.getAttribute("id"),s=ObjectUtil.reflect(window,i+FilePath.PREFIX,t);this.files.setValue(n,s)},e.prototype.getNumEnemies=function(){return this.numEnemies},e.prototype.getEnemySpeed=function(){return this.enemySpeed},e.prototype.getNumLives=function(){return this.numLives},e.prototype.getNumShields=function(){return this.numShields},e.prototype.getFiles=function(){return this.files},e}(),Loader=function(i){function e(e){var t=i.call(this)||this;return t.url=e,t}return __extends(e,i),e.prototype.load=function(){var e=new ConfigRequest(this.url);e.addEventListener(EventType.COMPLETE,this.handleConfigComplete,this),e.load()},e.prototype.handleConfigComplete=function(e){var t=e.currentTarget;this.config=t.getConfig();for(var i,n=t.getConfig().getFiles().getValues(),s=[],r=0;r<n.length;r++)i=n[r],s.push(i.url),AssetManager.addPath(i);this.loader=new PIXI.loaders.Loader,this.loader.add(s),this.loader.once("complete",ObjectUtil.delegate(this.handleFilesComplete,this)),this.loader.load()},e.prototype.handleFilesComplete=function(){this.dispatchEvent(new EventObject(EventType.COMPLETE))},e.prototype.getConfig=function(){return this.config},e}(EventDispatcher),ConfigRequest=function(i){function e(e){var t=i.call(this)||this;return t.url=e,t}return __extends(e,i),e.prototype.load=function(){$.get(this.url,null,ObjectUtil.delegate(this.handleConfigComplete,this),"xml")},e.prototype.handleConfigComplete=function(e){this.config=new ConfigData(e),this.dispatchEvent(new EventObject(EventType.COMPLETE,this))},e.prototype.getConfig=function(){return this.config},e}(EventDispatcher);